# 2022程序设计实践与进阶
#### 小组作业-进阶班二队

<!-- 我预计将通过此页面来互相告知工作进度以及自己的部分向外提供的接口如何使用，并通过processon.com来分配任务。

因此希望大家注册一下processon.com和pad.degrowth.net的账号，这样可以方便交流工作进度。

大家可以把这个页面当作每个人自己任务部分说明文档的合集。

最近希望大家尝试一下注册GitHub学生账号？这样应该可以方便源码组合。
 -->

# 需求和设计

## 总体设计：

网站总体风格应该类似于评课社区，页面风格简洁实用美观。上端应是Logo、登陆&个人中心链接，以及页面的切换选项，下端应该是网站信息，如作者、协议、法律声明等，中部应该是网站主体信息内容。整个网站应该分为4个部分：失物招领、权益投诉、柜君Tips、Q&A四部分。为了保护科大学生的隐私，本网站所有功能必须登陆后才能查看。

## UI设计：
<a href="http://home.ustc.edu.cn/~erchius_jzy/UIdemo/">
    UIdemo
</a>

## 失物招领

失误、招领功能做成2个界面，2个界面布局和功能类似。

页面上端应该是两个按钮：“发布失物”或“发布招领”，用于发帖。 

页面次上端有一个搜索框，可以支持根据地点、时间、物品、帖子标题等进行搜索。

页面主体就是不同的帖子，按照热度或时间的顺序排序。每个帖子应该是一个超链接方框，上边有粗体标题、地点、时间、物品、联系方式等信息。页面的右端应该有一个按钮“拾到此物”或者“我是失主”，左边应该是施主的账号头像信息。

任何账号点进标题后，应该显示帖子的具体内容。帖子需要实现举报功能，避免有人利用平台恶意发帖；还需要提供回帖功能，为失主提供必要的信息。回帖应集成Markdown功能，支持插入图片、设置格式等等。作为发帖人或管理员点进帖子中，可以删除帖子和回帖（找到失物或者物归原主后应该删除）。

任何账号进入发帖界面。发帖界面应包含若干文本框，包含：标题、丢失地点、丢失时间、丢失物品、联系方式，以及帖子的主体信息。帖子的主体信息应该支持Markdown功能，可以上传图片。发布帖子应该有验证码功能，可以选择匿名发布或者实名发布。

## 权益投诉
<a id="github" style="display>"></a>
类似于<a href="https://github.com/zzz14/LOST-FOUND">Github Issues</a>，主体页面和失物招领差不多，但不需要有搜索框。页面的最上端应有一个“我要投诉”按钮。进入投诉界面后，页面与功能与上类似。
页面主体就是不同的投诉帖子，按照时间和点赞数排序。每个帖子应该是一个超链接方框，从左到右应该是：用户头像账户信息，标题，标签，发布&更新时间，是否被解决。
任何账号点进标题后，应该显示帖子的具体内容，帖子需要实现举报和点赞功能，但只有管理员发布账户和可以回帖。作为发布账户，帖子的上端应有删除、已解决两个按钮；作为管理员账户，帖子的上端应有删除按钮，实现对应的功能。发帖应采用Markdown格式，可以上传图片。

## Q&A

该界面和“投诉功能”类似，不再赘述。

## 柜君tips

该界面功能的类似于以上，仍然用方框布局，管理员可以发布或删除Tips帖子，不准回帖或举报，可以点赞。

## 账号权限管理功能实现

主页面的右上角应显示：登陆&注册（未登录）或账户的头像（已登陆），登陆后点击头像进入账户的“个人中心”中。个人中心界面应模仿微信界面，应该包含如下内容：

1. 头像，昵称。
2. 信息完善。
3. 我的帖子。
4. 我的消息。
5. 退出登陆。

在非匿名的帖子中点进头像或者昵称，需要进入“个人主页”。该界面的设计可以参考<a href="#github">Github</a>，应该包括：公开信息和所发帖子两项。

注册账号，应提供科大邮箱，并发送验证码进行注册；忘记密码，应提供科大邮箱并发送验证码修改。注册账号后应产生一个UID作为唯一的账号标识。一个账号不可修改的信息包括：科大邮箱、UID（必须公开）。可修改的信息包括：昵称（必须填写并公开）、账号类型（必须存在并公开）、真实姓名、手机号、QQ、院系等。除昵称外，其他信息并非必须填写、公开。

网站的账号应该分为三类：超级管理员（站长）、管理员、普通用户。超级管理员指定且唯一，在其“个人中心”中应该增设一栏：权限管理，点进去应该按行按列显示管理员名单（头像+昵称+UID+一个罢免按钮+一个转让按钮），可以根据UID授予管理员，也可以罢免现有管理员，还可以转让超级管理员（转让后账号转为普通管理员）。对于普通管理员，有权利删除普通用户的帖子，或者发布柜君Tips、回复投诉和Q&A，甚至封禁普通用户。使用管理员身份进入普通用户界面，应该有“封禁”按钮，封禁该用户（含有选项：有期封禁、无期封禁）。
	作为任意用户，在以下情形下应收到相关消息：

- 自己被封禁时。
- 有人点击自己帖子的“拾到此物”或者“我是失主”按钮时。
- 投诉或者Q&A被回复时。

普通用户被封禁后，可以登陆账号，但是不准发帖、回复、点赞、举报。管理员不能被直接封禁，但是可以先被超级管理员罢免然后被封禁。

作为管理员实名发帖，自己的昵称后面有一个蓝色对勾；作为超级管理员实名发帖，自己的昵称后面有一个金色对勾（参考洛谷）。所有管理员必须实名，否则不能授予管理员。


# 工作进度

请大家把自己的任务分成若干部分，用复选框表现自己的工作进度。
实例在xia

## UI设计

- [x] [UIdemo](https://home.ustc.edu.cn/~erchius_jzy)



# 工作

## 设计

### 功能方面

#### 失物招领

1. 失主/拾取者注册并登录
2. 发布挂失/失物招领帖子
    - 标题
    - 时间，大致地点
    - 物品（附照片）
    - 联系方式（显式）
    - 正文（主要为描述物品）
3. 拾取者/失主注意到帖子并申请认领/归还
4. 帖子被响应时网站提示发帖人
5. 个人完成核实失主身份
6. 最后双方确认完成交接，帖子销毁

#### Q&A



### 合作方面
- 接口
- 界面（纯前端）
- 后端模块
- github

## 暂时文档

1. 静态页面结构

   admin/	自带后台

   lf/	失物招领

   report/ 	权益投诉

   tips/		柜君tips

   qa/ 	Q&A

   user/ 	个人中心

   login/	登入界面

   api/ 接口

   直接访问网址，直接redirect（重定向）到/lf页面上

2. 接口设计

   GET和POST的规范，类似于清华大学类似项目的文档。**各种API接口返回JSON格式！！！**

   ### 一、失物招领相关接口

   - api/lf/list	列表。使用GET方法。接口如下：

     | 参数     | 类型             | 作用               |
     | -------- | ---------------- | ------------------ |
     | title    | 字符串           | 搜索标题中的字符   |
     | date_old | YYYY-MM-DD       | 最近日期           |
     | date_new | YYYY-MM-DD       | 最远日期           |
     | place    | 字符串           | 丢失地点           |
     | name     | 字符串           | 丢失物品           |
     | page     | 数字             | 第几页(一页N=20条) |
     | type     | 单个字符'L'或'F' | 类型（默认为'F'）  |

     返回格式。界面类似于百度贴吧。

     ```json
     {
         "result" : "success",
         "total_page" : 5,
         "privilege" : "root",
         "data" : [
             {
                 "id":2,
             	"title" : "丢了一把伞，求助!",
                 "date" : "2022-03-05",
                 "place" : "一教",
                 "name" : "伞",
                 "type" : 'L',
                 "time" : "2022-03-06 06:00:00",
                 "author" : ,
                 "status" : 1,
         		"public" : true
         	},......
         ]
     }
     ```
     

所有项均不必须。
     
status = 0 表示"还没找到"，=1表示"已经被捡到了等待确认",=2表示"已经找到"(虽然按照现在的设计，已经找到会被删除，但目前还是这样)。
     
total_page表示这个搜索一共有多少页，从而让前端决定是否使用分页。
     
date_old和date_new返回丢失时间的范围。
     
privilege表示特权，有三档：root，admin，guest。
     
public表示是否公开。
     
其他内容可以根据对应的英文名称猜测其意思，不再赘述。
     
- api/lf/release 发布。使用POST方法。接口如下：
  
  | 参数   | 类型             | 作用             |
  | ------ | ---------------- | ---------------- |
  | title  | 字符串           | 搜索标题中的字符 |
  | date   | YYYY-MM-DD       | 日期             |
  | place  | 字符串           | 丢失地点         |
  | name   | 字符串           | 丢失物品         |
  | text   | 字符串           | 文字内容         |
  | pic1   | 二进制流         | 图片1            |
  | pic2   | 二进制流         | 图片2            |
  | pic3   | 二进制流         | 图片3            |
  | type   | 单个字符'L'或'F' | 类型             |
  | public | 布尔型           | 是否公开         |
  
  除了文字和图片以外，所有项均必须。可以考虑增加图片的最大上传数量，参数类似。返回结果：
  
  ```json
     {
         "result" : "success",
         "id" : 123456
     }
  ```
  
  并重定向到该帖子上去。（若失败则为fail，并附上msg表示错误信息）
  
- api/lf/delete 删除帖子。使用POST方法。接口如下：
  
  | 参数 | 类型 | 作用   |
  | ---- | ---- | ------ |
  | id   | 数字 | 帖子id |
  
  返回结果：
  
  ```json
     {	"result": "sucess"	}
  ```
  
- api/lf/pick 捡到失物。所有项目与上一条同。
  
- api/lf/reply 回复帖子。使用POST方法。接口如下：
  
  | 参数    | 类型     | 作用     |
  | ------- | -------- | -------- |
  | post_id | 数字     | 帖子id   |
  | text    | 字符串   | 文字内容 |
  | pic1    | 二进制流 | 图片1    |
  | pic2    | 二进制流 | 图片2    |
  | pic3    | 二进制流 | 图片3    |
  | public  | 布尔型   | 是否公开 |
  
  返回结果同上，即只有一个result。
  
- api/lf/?????? 询问某个帖子的数据，还没想好应该是什么。
  
- lf/ 查看主页。GET方法，无参数，返回HTML页面。
  
- lf/[%d] 查看id=%d某一条帖子。GET方法，无参数，返回查看帖子的HTML页面。


   ### 二、用户相关的接口

   - api/auth/captcha	发送验证码。POST方法：参数如下

     | 参数  | 类型   | 作用     |
     | ----- | ------ | -------- |
     | email | 字符串 | 科大邮箱 |

     返回格式：result。。。。（同上）

   - api/auth/register 注册。POST方法。参数如下：

     | 参数     | 类型   | 作用     |
     | -------- | ------ | -------- |
     | email    | 字符串 | 科大邮箱 |
     | username | 字符串 | 用户名   |
     | password | 字符串 | 密码     |
     | captcha  | 字符串 | 验证码   |
     | stu_id   | 字符串 | 学号     |

     返回格式：同上。后端将会设置username长度为[1，20]，密码长度为[6，20]，否则返回错误。

   - api/auth/login 登陆。POST方法，参数如下：

     | 参数     | 类型   | 作用 |
     | -------- | ------ | ---- |
     | stu_id   | 字符串 | 学号 |
     | password | 字符串 | 密码 |

     返回格式：同上。

   - api/auth/forget 忘记密码。 POST方法，参数如下：

     | 参数     | 类型   | 作用     |
     | -------- | ------ | -------- |
     | email    | 字符串 | 科大邮箱 |
     | password | 字符串 | 密码     |
     | captcha  | 字符串 | 验证码   |

     调用此方法前必须先调用captcha获得验证码。返回同上。

   - api/auth/logout 登出。POST方法，无参数，返回同上。前端可能需要redirect一下子。

   - api/auth/chpwd 更换密码。POST方法。必须登录后访问。参数是：

     | 参数 | 类型   | 作用   |
     | ---- | ------ | ------ |
     | old  | 字符串 | 原密码 |
     | new  | 字符串 | 后密码 |

     返回同上。

   - api/auth/update 更换信息。POST方法。必须登录后访问，参数是：

     | 参数                     | 类型         | 作用   |
     | ------------------------ | ------------ | ------ |
     | username                 | 字符串       | 用户名 |
     | mobile                   | 纯数字字符串 | 手机号 |
     | qq                       | 纯数字字符串 | qq号   |
     | name                     | 字符串       | 姓名   |
     | stu_id                   | 纯数字字符串 | 学号   |
     | 不准更改邮箱。返回同上。 |              |        |

   - api/auth/user/<%d> 用户信息。GET方法，参数是用户的uid。必须是登陆状态。返回信息：

     ```
     {
     	email: "...@...",
     	username: "",
     	mobile : "",
     	qq : "",
     	stu_id : "",
        realname : "",
        id : "",
        avatar: "",
     }
     ```

     类似等等。

   - api/auth/me 自己的信息。GET方法，等同于api/auth/user/{self.id}

        -  api/auth/chavatar 更改头像。POST方法，必须登陆后访问，参数是
        
     | 参数   | 类型   | 作用     |
     | ------ | ------ | -------- |
     | avatar | 二进制 | 上传文件 |
     

    返回格式同上

 - 为什么没有提升管理员权限的api

     因为django有个后台，可以管理用户权限，我直接在后台设置super user就可以了。

  ### 三、问答相关的接口

## 请注意，后端为了懒省事，把问答和贴士两个模块合二为一，因为这两个模块内容99%都是一样的！因此，每一个请求必须附带的参数是type=Q(表示问答)或者type=T(表示帖子)

- api/post/list	查询表单。GET方法，参数如下：
     | 参数 | 类型            | 作用 |
     | ---- | --------------- | ---- |
     | type | Q或T（默认为Q） | 类型 |
     | page | 数字（默认为1） | 页数 |

返回值：

  ```json
  {
      "result" : "success",
      "total_page" : 5,
      "privilege" : "root",
      "data" : [
          {
          	"q" : "目前四教的建设情况",
              "a" : "还没建。"
              "time" : "2022-03-06",
              "top" : 1,
              "id" : 123
      	},......
      ]
  }
  ```

  按照是否置顶为第一关键字，发布时间为第二关键字降序排序。

- api/post/release 发布。POST方法，必须管理员账号登陆后访问

  | 参数 | 类型   | 作用     |
  | ---- | ------ | -------- |
  | type | Q或T   | 类型     |
  | q    | 字符串 | 标题     |
  | a    | 字符串 | 内容     |
  | top  | 0或1   | 是否置顶 |

    对于问答来说，q就是Question，a就是Answer；对于Tips来收q就是tip的名称，a就是贴士的内容。（请忽略接口的名称）

- api/post/delete 和删除帖子的api一切相同，必须管理员账号登陆后访问。(只有一个id)

- api/post/change 改变状态。POST方法，

- | 参数 | 类型   | 作用       |
  | ---- | ------ | ---------- |
  | id   | 数字   | 帖子的编号 |
  | q    | 字符串 | 问题       |
  | a    | 字符串 | 答案       |
  | top  | 0或1   | 是否置顶   |
  
  id参数必须存在且合法，其他参数若没有则代表没有更改。返回值success或者fail。必须管理员账号登陆后访问。

- post/<%d> 查看某条帖子。GET方法，无参数，返回查看帖子的HTML页面。[计划删除这个接口]

  ### 四、投诉的相关的接口

### 点赞系列功能暂时不实现！！

- api/report/list	查询表单。GET方法，参数如下：
  
| 参数  | 类型                           | 作用       |
| ----- | ------------------------------ | ---------- |
| order | "new"、"hot"、"all"(默认为new) | 按什么排序 |
| page  | 数字（默认为1）                | 页数       |

   new：按照最新的排序；hot：按照点赞数最多排序。all：按照综合规则排序。综合规则暂定是：

   (发帖时间-2022年6月6日0时0分).小时数 + 点赞数^2		(暂时不实现)

   

   返回值：

     ```json
     {
         "result" : "success",
         "total_page" : 5,
         "privilege" : "root",
         "data" : [
             {
                 "id" : 123,
          	  "title" : "为什么中去宿舍没网",
                 "text" : "***************"
                 "time" : "2022-03-06 00:00:00",
                 "star_num": 100
                 "is_star": 0,
                 "reply": "就是没网，怎么滴？"
         	},......
         ]
     }
     ```

   star_num表示点赞的数量，is_star表示是不是已经点赞过了。

   

- api/report/star	点赞。暂时不实现。

- api/report/delete 删除帖子。与api/lf/delete类似。

- api/report/release 发布帖子：POST方法，（图片暂时不支持，下个版本再迭代）

   | 参数  | 类型     | 作用             |
   | ----- | -------- | ---------------- |
   | title | 字符串   | 搜索标题中的字符 |
   | text  | 字符串   | 文字内容         |
   | pic1  | 二进制流 | 图片1            |
   | pic2  | 二进制流 | 图片2            |
   | pic3  | 二进制流 | 图片3            |

   返回仍然是类似内容。

- api/report/reply 回复帖子：POST方法，只有管理员账号允许：（图片暂时不支持，下个版本再迭代）

   | 参数 | 类型     | 作用     |
   | ---- | -------- | -------- |
   | id   | 数字     | 帖子编号 |
   | text | 字符串   | 文字内容 |
   | pic1 | 二进制流 | 图片1    |
   | pic2 | 二进制流 | 图片2    |
   | pic3 | 二进制流 | 图片3    |

   

:::warning
为了压缩空间，或许可以考虑把status和type放在一起（
:::

数据库格式之后不更了，看代码就行（雾）

:::warning
我直接用百度CDN的jQuery了啊
:::